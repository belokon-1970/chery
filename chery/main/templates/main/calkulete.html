{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{% block title %}{% endblock %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <link rel="stylesheet" href="{% static 'main/css/main.css' %}">
  <style>
    :root {
      --bg: #0b1020;
      --card: #141b2e;
      --primary: #4f8cff;
      --text: #e8eaf6;
      --muted: #a6aec7;
      --input: #1e2540;
      --shadow: 0 10px 25px rgba(0,0,0,.25);
    }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: linear-gradient(135deg, #0b1020 0%, #1a2140 100%);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      width: 100%;
      max-width: 720px;
      background: linear-gradient(180deg, rgba(20,26,48,.98), rgba(20,26,48,.92) 60%), var(--card);
      border-radius: 14px;
      padding: 20px 20px 16px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.05);
    }
    h1 {
      font-size: 1.25rem;
      margin: 0 0 12px;
      color: #fff;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    label {
      display: block;
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 6px;
    }
    input[type="number"], select {
      width: 100%;
      padding: 12px 12px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.15);
      background: var(--input);
      color: #fff;
      font-size: 1rem;
    }
    .full { grid-column: 1 / span 2; }
    .row { display: flex; align-items: center; gap: 8px; }
    .range { width: 100%; }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 16px;
      border-radius: 8px;
      border: none;
      background: linear-gradient(135deg, #4f8cff, #2e6bd9);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: transform .2s;
    }
    .btn:active { transform: translateY(1px) scale(0.98); }
    .result {
      color: #fff;
      margin-top: 6px;
      padding: 12px;
      border-radius: 8px;
      background: rgba(78, 88, 162, 0.25);
      border: 1px solid rgba(78, 88, 162, 0.5);
    }
    .muted { color: var(--muted); font-size: 0.9rem; }
    @media (max-width: 700px) {
      .grid { grid-template-columns: 1fr; }
      .full { grid-column: 1 / -1; }
    }
  </style>
</head>
<body>
  <section class="card" aria-label="Кредитный калькулятор транспорта">
    <h1>Кредитный калькулятор транспорта</h1>

    <div class="grid" id="form-grid">
      <div class="field">
        <label for="amount">Сумма кредита (руб):</label>
        <input type="number" id="amount" min="1000" step="1000" value="8000000" />
      </div>

      <div class="field">
        <label for="rate">Годовая ставка (%):</label>
        <input type="number" id="rate" min="0" step="0.01" value="9.9" />
      </div>

      <div class="field">
        <label for="years">Срок кредита (лет):</label>
        <input type="number" id="years" min="1" max="30" step="1" value="5" />
      </div>

      <div class="field full">
        <label for="paymentsPerYear">Частота платежей:</label>
        <select id="paymentsPerYear" aria-label="Частота платежей">
          <option value="12" selected>Ежемесячно</option>
          <option value="6">Раз в полгода</option>
          <option value="4">Раз в квартал</option>
        </select>
      </div>

      <div class="field full" style="text-align:center;">
        <button class="btn" id="calculateBtn" type="button" aria-label="Рассчитать EMI">
          Рассчитать EMI
        </button>
      </div>

      <div class="field full" id="result" style="display:none;">
        <div class="result" aria-live="polite">
          <div>Ежемесячный платеж: <strong id="emi">0</strong> руб/платёж</div>
          <div>Общая выплата: <strong id="totalPay">0</strong> руб</div>
          <div>Переплата: <strong id="overpayment">0</strong> руб</div>
        </div>
      </div>
    </div>
  </section>
  <script>
    // Вспомогательная функция форматирования числа
    function fmt(n) {
      return new Intl.NumberFormat('ru-RU', { minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(n);
    }

    function computeEMI(principal, annualRate, years, paymentsPerYear) {
      // Приводим к периодам платежей
      const r = (annualRate / 100) / paymentsPerYear;
      const n = years * paymentsPerYear;
      if (r === 0) return { payment: principal / n, total: principal, interest: 0 };
      const payment = principal * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
      const total = payment * n;
      const interest = total - principal;
      return { payment, total, interest };
    }

    document.getElementById('calculateBtn').addEventListener('click', function() {
      const amount = parseFloat(document.getElementById('amount').value) || 0;
      const rate = parseFloat(document.getElementById('rate').value) || 0;
      const years = parseInt(document.getElementById('years').value) || 0;
      const paymentsPerYear = parseInt(document.getElementById('paymentsPerYear').value) || 12;

      if (amount <= 0 || rate < 0 || years <= 0) {
        alert('Пожалуйста, заполните корректные значения.');
        return;
      }

      const result = computeEMI(amount, rate, years, paymentsPerYear);
      const emiRounded = Math.round(result.payment);
      const totalRounded = Math.round(result.total);
      const overRounded = Math.round(result.interest);

      document.getElementById('emi').textContent = fmt(emiRounded);
      document.getElementById('totalPay').textContent = fmt(totalRounded);
      document.getElementById('overpayment').textContent = fmt(overRounded);

      document.getElementById('result').style.display = 'block';
    });
  </script>
</body>
</html>
    {% block content %}
{% endblock%}