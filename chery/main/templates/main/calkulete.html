{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Кредитный калькулятор транспорта</title>
  <style>
    :root{
  --bg: #0f1220;
  --card: #141a2a;
  --text: #eaeaf0;
  --muted: #a6a6b2;
  --accent: #5b8cff;
  --accent-2: #22c55e;
  --border: #2a2f4a;
  --button: #1f2a5a;
  --button-alt: #334a8b;
}

* { box-sizing: border-box; }

html, body {
  height: 100%;
  margin: 0;
  background: linear-gradient(135deg, #0b0f1f 0%, #1a1f2b 60%, #0b1020 100%);
  color: var(--text);
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

body {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 32px;
}

.calculator {
  width: 100%;
  max-width: 720px;
  background: rgba(20,26,42,0.95);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 24px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.4);
}

h1 {
  margin: 0 0 16px;
  font-size: 1.4rem;
  font-weight: 700;
  text-align: center;
  color: #fff;
}

.field {
  display: flex;
  flex-direction: column;
  margin-bottom: 12px;
}
.field.inline {
  width: 48%;
}
.field.inline + .field.inline { margin-left: 4%; }

label {
  font-size: 0.9rem;
  color: var(--muted);
  margin-bottom: 6px;
}

select, input[type="text"], input[type="number"] {
  background: #0e1224;
  color: #fff;
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 10px 12px;
  font-size: 1rem;
  outline: none;
}

select:focus, input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(91,140,255,0.15);
}

.field.inline label { margin-bottom: 6px; }

.actions {
  display: flex;
  gap: 12px;
  justify-content: space-between;
  align-items: center;
  margin-top: 6px;
  flex-wrap: wrap;
}

.btn {
  background: linear-gradient(135deg, var(--button), #2a3170);
  border: none;
  color: white;
  padding: 12px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}
.btn.secondary {
  background: #2a2f4a;
}
.btn:hover { filter: brightness(1.05); transform: translateY(-1px); }
.btn:active { transform: translateY(0); }

.result {
  margin-top: 20px;
  padding: 16px;
  background: rgba(20,26,42,0.7);
  border: 1px solid var(--border);
  border-radius: 12px;
}
.result h2 {
  margin: 0 0 8px;
  font-size: 1.1rem;
}
.muted { color: var(--muted); }

@media (max-width: 700px) {
  .field.inline { width: 100%; }
  .actions { flex-direction: column; align-items: stretch; }
}
  </style>
</head>
<body>
  <main class="calculator">
    <h1>Кредитный калькулятор транспорта</h1>

    <form id="loanForm" autocomplete="off" novalidate>
      <div class="field">
        <label for="vehicleType">Тип транспорта</label>
        <select id="vehicleType" name="vehicleType" required>
          <option value="" disabled selected>Выберите тип</option>
          <option value="Легковой автомобиль">Легковой автомобиль</option>
          <option value="Грузовой автомобиль">Грузовой автомобиль</option>
          <option value="Мотоцикл">Мотоцикл</option>
          <option value="Электромобиль">Электромобиль</option>
        </select>
      </div>

      <div class="field">
        <label for="vehicleName">Название/модель</label>
        <input type="text" id="vehicleName" name="vehicleName" placeholder="Например, Model X" required />
      </div>

      <div class="field">
        <label for="price">Цена (₽)</label>
        <input type="number" id="price" name="price" placeholder="Введите цену" min="0" step="0.01" required />
      </div>

      <div class="field inline">
        <label for="downPayment">Первоначальный взнос (₽)</label>
        <input type="number" id="downPayment" name="downPayment" placeholder="0" min="0" step="0.01" />
      </div>

      <div class="field inline">
        <label for="rate">Ставка по кредиту (% годовых)</label>
        <input type="number" id="rate" name="rate" placeholder="например 7.5" min="0" step="0.01" required />
      </div>

      <div class="field inline">
        <label for="term">Срок кредита (лет)</label>
        <input type="number" id="term" name="term" placeholder="например 5" min="1" step="1" required />
      </div>

      <div class="actions">
        <button type="submit" class="btn">Рассчитать</button>
        <button type="button" id="reset" class="btn secondary">Сбросить</button>
      </div>
    </form>

    <section id="result" class="result" hidden>
      <h2>Результаты</h2>
      <p><strong>Транспорт:</strong> <span id="resVehicle"></span> <span id="resName" class="muted"></span></p>
      <p><strong>Цена:</strong> <span id="resPrice"></span> ₽</p>
      <p><strong>Первоначальный взнос:</strong> <span id="resDown"></span> ₽</p>
      <p><strong>Ежемесячный платеж (EMI):</strong> <span id="resEmi"></span> ₽</p>
      <p><strong>Переплата за срок кредита:</strong> <span id="resTotalInterest"></span> ₽</p>
      <p><strong>Общая выплата:</strong> <span id="resTotalPayment"></span> ₽</p>
    </section>
  </main>

  <script>
    (function() {
  const form = document.getElementById('loanForm');
  const resultSection = document.getElementById('result');
  const resVehicle = document.getElementById('resVehicle');
  const resName = document.getElementById('resName');
  const resPrice = document.getElementById('resPrice');
  const resDown = document.getElementById('resDown');
  const resEmi = document.getElementById('resEmi');
  const resTotalInterest = document.getElementById('resTotalInterest');
  const resTotalPayment = document.getElementById('resTotalPayment');
  const resetBtn = document.getElementById('reset');

  function formatMoney(n) {
    return new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'RUB', maximumFractionDigits: 0 }).format(n);
  }

  function calculate() {
    const vehicleType = document.getElementById('vehicleType').value;
    const vehicleName = document.getElementById('vehicleName').value.trim();
    const price = parseFloat(document.getElementById('price').value);
    const down = parseFloat(document.getElementById('downPayment').value) || 0;
    const annualRate = parseFloat(document.getElementById('rate').value);
    const termYears = parseInt(document.getElementById('term').value, 10);

    // Простая валидация
    if (!vehicleType || !price || !annualRate || !termYears) {
      alert('Пожалуйста, заполните все обязательные поля: тип, цена, ставка и срок.');
      return;
    }

    const loanAmount = Math.max(0, price - down);
    const monthlyRate = annualRate / 12 / 100;
    const n = termYears * 12;

    // EMI расчет по формуле аннуитетного платежа
    let emi = 0;
    if (monthlyRate === 0) {
      emi = loanAmount / n;
    } else {
      emi = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, n)) / (Math.pow(1 + monthlyRate, n) - 1);
    }

    const totalPayment = emi * n;
    const totalInterest = totalPayment - loanAmount;

    // Отображение
    resVehicle.textContent = vehicleType;
    resName.textContent = vehicleName ? ` (${vehicleName})` : '';
    resPrice.textContent = formatMoney(price);
    resDown.textContent = formatMoney(down);
    resEmi.textContent = formatMoney(emi);
    resTotalInterest.textContent = formatMoney(totalInterest);
    resTotalPayment.textContent = formatMoney(totalPayment);

    resultSection.hidden = false;
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    calculate();
  });

  resetBtn.addEventListener('click', () => {
    form.reset();
    resultSection.hidden = true;
  });
})();
  </script>
</body>
</html>